<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Track Report - CivicSense</title>
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="flex flex-col min-h-screen">

<!-- Navbar -->
<nav class="bg-blue-700 text-white shadow-lg">
  <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
    <a href="index.html" class="text-2xl font-bold tracking-wide">CivicSense</a>
    <div class="space-x-6">
      <a href="index.html" class="hover:text-gray-200">Home</a>
      <a href="report.html" class="hover:text-gray-200">Report</a>
      <a href="track.html" class="hover:text-gray-200 font-semibold">Track</a>
      <a href="about.html" class="hover:text-gray-200">About</a>
    </div>
  </div>
</nav>

<!-- Main Section -->
<main class="flex-grow relative py-16"
      style="background: url('https://images.unsplash.com/photo-1582213782179-e0d53f98f2ca?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80') no-repeat center center/cover;">
  <div class="absolute inset-0 bg-black/30 backdrop-blur-sm"></div>

  <div class="relative max-w-4xl mx-auto px-6 z-10">
    <h2 class="text-3xl font-bold text-white mb-6 text-center drop-shadow-lg">Track Your Reports</h2>

    <div class="bg-white/80 p-6 rounded-xl shadow-lg border border-gray-200/30">

      <!-- Clear Reports Button -->
      <div class="flex justify-end mb-4">
        <button id="clearReportsBtn" class="bg-red-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-red-700 transition-colors duration-200">
          <i class="fas fa-trash-alt mr-2"></i>Clear All Reports
        </button>
      </div>

      <!-- Report Cards -->
      <div id="reportContainer" class="space-y-4"></div>

    </div>
  </div>
</main>

<!-- Footer -->
<footer class="bg-blue-700 text-white py-6 mt-0 border-t-0">
  <div class="max-w-7xl mx-auto px-6 flex flex-col md:flex-row justify-between items-center">
    <p class="text-sm">Â© 2025 CivicSense. All rights reserved.</p>
    <div class="space-x-4 mt-3 md:mt-0">
      <a href="#" class="hover:text-gray-300"><i class="fab fa-facebook"></i></a>
      <a href="#" class="hover:text-gray-300"><i class="fab fa-twitter"></i></a>
      <a href="#" class="hover:text-gray-300"><i class="fab fa-instagram"></i></a>
    </div>
  </div>
</footer>
<script>
// Stages of complaint
const stages = ["Pending", "Assigned", "Completed", "Feedback"];
const stageColors = ["bg-red-500","bg-yellow-400","bg-green-500","bg-purple-600"];

function renderReports() {
  const container = document.getElementById('reportContainer');
  const reports = JSON.parse(localStorage.getItem('reports')) || [];
  container.innerHTML = '';

  if(reports.length === 0){
    container.innerHTML = '<p class="text-center text-gray-500">No reports submitted yet.</p>';
    return;
  }

  reports.forEach((report, index)=>{
    const stage = report.stage || 1;
    const progressPercent = (stage / stages.length) * 100;
    const progressColor = stageColors[stage-1];
    
    const card = document.createElement('div');
    card.className = 'bg-white p-4 rounded-xl shadow-md border border-gray-300 mb-4';

    card.innerHTML = `
      <h3 class="font-semibold text-xl mb-2">${report.type}</h3>
      <p class="text-gray-700 mb-1">Location: ${report.location}</p>
      <p class="text-gray-700 mb-1">Submitted At: ${report.time || 'N/A'}</p>
      <p class="text-gray-700 mb-2">Status: <span id="status-${index}" class="font-bold">${report.status || stages[stage-1]}</span></p>
      
      <!-- Progress Bar -->
      <div class="w-full bg-gray-200 h-4 rounded-full mb-2 overflow-hidden">
        <div id="progress-${index}" class="${progressColor} h-full text-center text-white font-semibold" style="width:${progressPercent}%">
          ${Math.round(progressPercent)}%
        </div>
      </div>

      <!-- Feedback Section -->
      <div id="feedbackSection-${index}" class="${(stage === 3 && !report.feedback) ? '' : 'hidden'}">
        <label class="block text-gray-700 font-semibold mb-1">Add Feedback:</label>
        <textarea id="feedbackInput-${index}" rows="3" class="w-full border rounded p-2 mb-2" placeholder="Write your feedback..."></textarea>
        <button id="feedbackBtn-${index}" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">Submit Feedback</button>
      </div>

      <!-- Display submitted feedback -->
      <div id="feedbackDisplay-${index}" class="mt-2 text-green-700 font-semibold ${report.feedback ? '' : 'hidden'}">
        Feedback Submitted: <span>${report.feedback || ''}</span>
      </div>
    `;

    container.appendChild(card);

    // Feedback button logic
    if(stage === 3 && !report.feedback){
      document.getElementById(`feedbackBtn-${index}`).addEventListener('click', ()=>{
        const feedbackText = document.getElementById(`feedbackInput-${index}`).value.trim();
        if(!feedbackText) return alert("Please enter feedback before submitting.");

        report.feedback = feedbackText;
        report.status = 'Closed';
        report.stage = 4; // fully complete
        localStorage.setItem('reports', JSON.stringify(reports));

        // Update UI
        document.getElementById(`status-${index}`).innerText = 'Closed';
        document.getElementById(`feedbackSection-${index}`).classList.add('hidden');
        const display = document.getElementById(`feedbackDisplay-${index}`);
        display.innerHTML = `Feedback Submitted: <span>${feedbackText}</span>`;
        display.classList.remove('hidden');
        document.getElementById(`progress-${index}`).style.width = '100%';
        document.getElementById(`progress-${index}`).innerText = '100%';
      });
    }
  });
}

// Clear all reports
document.getElementById('clearReportsBtn').addEventListener('click', ()=>{
  localStorage.removeItem('reports');
  renderReports();
});

// Auto-refresh every 3 seconds to reflect officer updates
setInterval(renderReports, 10000);

renderReports();
</script>


</body>
</html>
